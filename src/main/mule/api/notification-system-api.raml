#%RAML 1.0
title: Lula Insurance - Notification & Document System API
version: v1
baseUri: https://api.lulainsurance.com/system/notifications/{version}
mediaType: application/json
protocols: [ HTTPS ]

description: |
  System API responsible for sending notifications and
  generating/delivering policy documents (PDF).
  This API is called by MuleSoft Process APIs only.

# =========================================================
# Security Scheme: Client ID & Client Secret
# =========================================================
securitySchemes:
  client_id_enforcement:
    type: x-client-id-enforcement
    description: Client ID and Client Secret enforcement
    describedBy:
      headers:
        client_id:
          type: string
          required: true
        client_secret:
          type: string
          required: true
      responses:
        401:
          description: Unauthorized
        403:
          description: Forbidden

securedBy:
  - client_id_enforcement

# =========================================================
# Types
# =========================================================
types:

  NotificationRequest:
    type: object
    properties:
      policyId:
        type: string
        required: true
      recipient:
        type: object
        required: true
        properties:
          email:
            type: string
            required: true
          phone:
            type: string
            required: false
      notificationType:
        type: string
        enum: [ POLICY_BOUND, PAYMENT_CONFIRMED ]
        required: true
      generateDocument:
        type: boolean
        default: true
        required: false

  NotificationResponse:
    type: object
    properties:
      notificationId:
        type: string
      policyId:
        type: string
      status:
        type: string
        enum: [ SENT ]
      message:
        type: string

  ErrorResponse:
    type: object
    properties:
      errorCode:
        type: string
      errorMessage:
        type: string
      correlationId:
        type: string

# =========================================================
# Resources
# =========================================================
/notifications:
  post:
    description: |
      Sends notification to customer or broker and optionally
      generates and delivers policy documents.
    body:
      application/json:
        type: NotificationRequest
        example:
          {
            "policyId": "POL-998877",
            "recipient": {
              "email": "customer@email.com",
              "phone": "+15551234567"
            },
            "notificationType": "POLICY_BOUND",
            "generateDocument": true
          }
    responses:
      201:
        description: Notification sent successfully
        body:
          application/json:
            type: NotificationResponse
            example:
              {
                "notificationId": "NOTIF-123456",
                "policyId": "POL-998877",
                "status": "SENT",
                "message": "Notification and documents sent successfully"
              }
      400:
        description: Invalid request
        body:
          application/json:
            type: ErrorResponse
      401:
        description: Unauthorized
        body:
          application/json:
            type: ErrorResponse
      500:
        description: Notification or document service error
        body:
          application/json:
            type: ErrorResponse
